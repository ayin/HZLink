var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},BaseDialog=function(t){function e(){var e=t.call(this)||this;return e.verticalCenter=e.horizontalCenter=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.show=function(){UIManager.getInstance().show(this)},e.prototype.close=function(){UIManager.getInstance().close(this)},e}(eui.Component);__reflect(BaseDialog.prototype,"BaseDialog");var Dialog=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.titleDisplay&&(this.titleDisplay.text=this._title),this.closeBtn&&this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeDialog,this)},Object.defineProperty(e.prototype,"title",{get:function(){return this._title},set:function(t){this._title=t,this.titleDisplay&&(this.titleDisplay.text=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"content",{set:function(t){this.header&&(t.top=this.header.height+10),this.addChild(t)},enumerable:!0,configurable:!0}),e.prototype.closeDialog=function(){this.close(),this.closeCallback&&this.closeCallback()},e.prototype.onClose=function(t){this.closeCallback=t},e}(BaseDialog);__reflect(Dialog.prototype,"Dialog");var Page=function(t){function e(e){var n=t.call(this)||this;return n._data=e,n}return __extends(e,t),e.prototype.getData=function(){return this._data},e}(eui.Group);__reflect(Page.prototype,"Page");var MissionSucDialog=function(t){function e(e){var n=t.call(this)||this;return n.time=e,n.title="恭喜过关",n}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=new eui.Group;e.percentWidth=100,e.percentHeight=100,e.layout=new eui.VerticalLayout;var n=new eui.Label;n.text="用时："+TimeUtils.formatTime(this.time),n.size=40,n.textColor=0,n.textAlign=egret.HorizontalAlign.CENTER,n.percentWidth=100,e.addChild(n);var i=this.calStar(this.time);GameData.getInstance().setStar(i),e.addChild(this.getStars(i)),e.addChild(this.getButtons()),this.content=e},e.prototype.calStar=function(t){return 60>t?3:90>t?2:120>t?1:0},e.prototype.getButtons=function(){var t=new eui.Group;t.percentWidth=100,t.horizontalCenter=0;var e=new eui.HorizontalLayout;e.gap=10,e.paddingTop=10,e.paddingBottom=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=e;var n=new eui.Button;n.skinName="resource/skins/BtnHome.exml",n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHome,this),t.addChild(n);var i=new eui.Button;return i.skinName="resource/skins/BtnRestart.exml",i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRestart,this),t.addChild(i),t},e.prototype.getStars=function(t){var e=new eui.Group;e.percentWidth=100,e.height=80;var n=new eui.HorizontalLayout;n.horizontalAlign=egret.HorizontalAlign.CENTER,e.layout=n;for(var i=RES.getRes("listli_stara"),o=[],r=0;3>r;r++){o[r]=new eui.Image(i),o[r].verticalCenter=0,o[r].horizontalCenter=0,o[r].scaleX=1.6,o[r].scaleY=1.6;var a=new eui.Group;a.width=80,a.height=80,a.addChild(o[r]),e.addChild(a)}var s=RES.getRes("listli_starl"),l=function(e){return setTimeout(function(){e>=t||(o[e].texture=s,o[e].scaleX=2,o[e].scaleY=2,SoundManager.getInstance().playEffectSound("bomb_wav"),l(e+1))},500)};return l(0),e},e.prototype.onHome=function(){this.close(),UIManager.getInstance().dispatchEvent(new MyEvent(MyEvent.OPEN_SELECT_BOOK))},e.prototype.onRestart=function(){this.close(),this.onRestartCallback&&this.onRestartCallback()},e}(Dialog);__reflect(MissionSucDialog.prototype,"MissionSucDialog");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?i(o):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GlobalIndex=function(){function t(){}return t.book=0,t.chapter=0,t.mission=0,t}();__reflect(GlobalIndex.prototype,"GlobalIndex");var GameData=function(t){function e(e){var n=t.call(this)||this;return n.books=[],e.books.forEach(function(t){return n.books.push(new GameDataBook(t))}),n}return __extends(e,t),e.getInstance=function(){if(null==this.instance){var t=StoreManager.getInstance().getGameData();null==t||void 0==t||""==t?this.instance=new e(RES.getRes("game_data_json")):this.instance=new e(JSON.parse(t)),this.instance.update()}return this.instance},e.prototype.toJson=function(){return JSON.stringify({books:this.books})},e.prototype.update=function(){this.books.forEach(function(t){return t.update()})},e.prototype.setStar=function(t){var e=GlobalIndex.book,n=GlobalIndex.chapter,i=GlobalIndex.mission;t<=this.books[e].chapters[n].star[i]||(this.books[e].chapters[n].star[i]=t,i==this.books[e].chapters[n].star.length-1&&(i=-1,n+=1,n==this.books[e].chapters.length-1&&(n=0,e+=1)),this.books[e].chapters[n].star[i+1]=0,StoreManager.getInstance().storeGameData(this.toJson()),this.update())},e}(egret.EventDispatcher);__reflect(GameData.prototype,"GameData");var GameDataBook=function(){function t(t){var e=this;this.chapters=[],this.name=t.name,t.chapters.forEach(function(t){return e.chapters.push(new GameDataChapter(t))})}return t.prototype.update=function(){this.chapters.forEach(function(t){return t.update()}),this.totalStar=this.chapters.reduce(function(t,e){return t+e.totalStar},0)},t}();__reflect(GameDataBook.prototype,"GameDataBook");var GameDataChapter=function(){function t(t){this.star=[],this.lock=!1,this.chars=t.chars,this.star=t.star}return t.prototype.update=function(){this.totalStar=this.star.reduce(function(t,e){return t+Math.max(0,e)},0),this.lock=this.star.every(function(t){return 0>t})},t.prototype.updateStar=function(t,e){this.star[t]=e,GameData.getInstance().update(),GameData.getInstance().dispatchEvent(new MyEvent(MyEvent.DATA_UPDATE))},t}();__reflect(GameDataChapter.prototype,"GameDataChapter");var GAME_STATUS;!function(t){t[t.START=0]="START",t[t.BOOK=1]="BOOK",t[t.CHAPTER=2]="CHAPTER",t[t.MISSION_SELECT=3]="MISSION_SELECT",t[t.MISSION=4]="MISSION",t[t.DIALOG=5]="DIALOG"}(GAME_STATUS||(GAME_STATUS={}));var GameManager=function(){function t(t){var e=this;this.gameStatus=GAME_STATUS.START,this.preStatus=null,this.root=t,this.initLayerDialog(),UIManager.getInstance().addEventListener(MyEvent.OPEN_SELECT_BOOK,this.openSelectBook,this),UIManager.getInstance().addEventListener(MyEvent.OPEN_SELECT_CHAPTER,this.openSelectChapter,this),UIManager.getInstance().addEventListener(MyEvent.OPEN_SELECT_MISSION,this.openSelectMission,this),UIManager.getInstance().addEventListener(MyEvent.OPEN_MISSION,this.openMission,this),UIManager.getInstance().addEventListener(MyEvent.UI_SHOW,this.uiShow,this),UIManager.getInstance().addEventListener(MyEvent.UI_CLOSE,this.uiClose,this),egret.ExternalInterface.addCallback("onKeyBack",function(t){if(console.log("From Native:"+t),e.gameStatus==GAME_STATUS.BOOK)egret.ExternalInterface.call("callNative","closeApp");else if(e.gameStatus==GAME_STATUS.CHAPTER){var n=new MyEvent(MyEvent.OPEN_SELECT_BOOK);UIManager.getInstance().dispatchEvent(n)}else if(e.gameStatus==GAME_STATUS.MISSION_SELECT){var i=new MyEvent(MyEvent.OPEN_SELECT_CHAPTER);i.data=GameData.getInstance().books[GlobalIndex.book],UIManager.getInstance().dispatchEvent(i)}else if(e.gameStatus==GAME_STATUS.MISSION){var o=new MyEvent(MyEvent.OPEN_SELECT_CHAPTER);o.data=GameData.getInstance().books[GlobalIndex.book],UIManager.getInstance().dispatchEvent(o)}else console.log("do nothing:"+e.gameStatus)})}return t.prototype.start=function(){UIManager.getInstance().dispatchEvent(new MyEvent(MyEvent.OPEN_SELECT_BOOK))},t.prototype.openSelectBook=function(t){null!=this.selectBook&&(this.root.removeChild(this.selectBook),this.selectBook=null),null!=this.selectMission&&(this.selectMission.visible=!1),null!=this.selectChapter&&(this.selectChapter.visible=!1),null!=this.mission&&(this.root.removeChild(this.mission),this.mission.removeChildren(),this.mission=null),SoundManager.getInstance().playEffectSound("in_mp3"),this.selectBook=new SelectBook2,this.root.addChild(this.selectBook),this.gameStatus=GAME_STATUS.BOOK},t.prototype.openSelectChapter=function(t){null!=this.selectMission&&(this.selectMission.visible=!1),null!=this.selectBook&&(this.selectBook.visible=!1),null!=this.mission&&(this.mission.visible=!1),null!=this.selectChapter&&(this.root.removeChild(this.selectChapter),this.selectChapter.removeChildren()),SoundManager.getInstance().playEffectSound("in_mp3"),this.selectChapter=new SelectChapter(t.data),this.root.addChild(this.selectChapter),this.gameStatus=GAME_STATUS.CHAPTER},t.prototype.openSelectMission=function(t){null!=this.selectBook&&(this.selectBook.visible=!1),null!=this.selectMission&&(this.root.removeChild(this.selectMission),this.selectMission=null),SoundManager.getInstance().playEffectSound("in_mp3"),this.selectMission=new SelectMission(t.data),this.root.addChild(this.selectMission),this.gameStatus=GAME_STATUS.MISSION_SELECT},t.prototype.openMission=function(t){null!=this.mission&&(this.root.removeChild(this.mission),this.mission=null),this.selectBook.visible=!1,this.selectMission.visible=!1,this.selectChapter.visible=!1,SoundManager.getInstance().playEffectSound("in_mp3"),this.mission=new Mission(t.data.index,t.data.chars),this.root.addChild(this.mission),this.gameStatus=GAME_STATUS.MISSION},t.prototype.uiShow=function(t){t.data instanceof BaseDialog&&this.showDialog(t.data)},t.prototype.uiClose=function(t){t.data instanceof BaseDialog&&this.hideDialog(t.data)},t.prototype.initLayerDialog=function(){this.layerDialog=new eui.Group,this.layerDialog.width=Global.WIDTH,this.layerDialog.height=Global.HEIGHT;var t=UiUtils.getShape(Global.WIDTH,Global.HEIGHT,0,.8);this.layerDialog.addChild(t),this.layerDialog.visible=!1,Global.stage.addChild(this.layerDialog)},t.prototype.showDialog=function(t){SoundManager.getInstance().playEffectSound("dialog_mp3"),this.layerDialog.visible=!0,this.layerDialog.addChild(t),this.preStatus=this.gameStatus,this.gameStatus=GAME_STATUS.DIALOG},t.prototype.hideDialog=function(t){SoundManager.getInstance().playEffectSound("in_mp3"),this.layerDialog.visible=!1,this.layerDialog.removeChild(t),this.gameStatus=this.preStatus},t}();__reflect(GameManager.prototype,"GameManager");var Global=function(){function t(){}return t.init=function(){egret.Capabilities.isMobile&&this.initWH(document.documentElement.clientWidth,document.documentElement.clientHeight,!1)},t.initWH=function(e,n,i){this.isNative||(i&&(this.isNative=!0),console.log("WH="+e+":"+n),this.WIDTH_S=e,this.HEIGHT_S=n,this.WIDTH=t.WIDTH,this.HEIGHT=t.WIDTH*t.HEIGHT_S/t.WIDTH_S,console.log("WH2="+this.WIDTH+":"+this.HEIGHT))},t.WIDTH=640,t.HEIGHT=960,t.__WIDTH=640,t.__HEIGHT=960,t.WIDTH_S=document.documentElement.clientWidth,t.HEIGHT_S=document.documentElement.clientHeight,t.isNative=!1,t}();__reflect(Global.prototype,"Global");var Info=function(t){function e(){var e=t.call(this)||this;return e.W=500,e.H=500,e.width=e.W,e.height=e.H,e}return __extends(e,t),e.prototype.childrenCreated=function(){var t=10,e=new eui.Label;e.text="规则介绍:",e.x=10,e.y=t,e.size=30,e.textColor=7895160,this.addChild(e),t=t+e.height+10;var n=new eui.Label;n.text="《汉字连连看》是一个把相同两个汉字连线后消除的益智游戏，游戏时请注意两个汉字连线之间的拐弯不能超过两个，如下图所示：",n.x=40,n.y=t,n.width=this.W-80,n.size=20,n.textColor=7895160,n.wordWrap=!0,this.addChild(n),t=t+n.height+25;var i=new RuleView("无转折",[["汉","字","消"],["学","乐","消"],["个","不","停"]],[new Pos(0,2),new Pos(1,2)]);i.x=(this.W/2-i.width)/2,i.y=t,this.addChild(i);var o=new RuleView("一个转折",[["汉","字","消"],["乐","消",""],["学","不","停"]],[new Pos(0,2),new Pos(1,2),new Pos(1,1)]);o.x=this.W/2+(this.W/2-i.width)/2,o.y=t,this.addChild(o),t=t+i.height+25;var r=new RuleView("两个转折",[["汉","字","消"],["","",""],["消","乐","学"]],[new Pos(0,2),new Pos(1,2),new Pos(1,1),new Pos(1,0),new Pos(2,0)]);r.x=(this.W/2-i.width)/2,r.y=t,this.addChild(r);var a=new RuleView("两个转折",[["汉","消",""],["字","乐",""],["学","消",""]],[new Pos(0,1),new Pos(0,2),new Pos(1,2),new Pos(2,2),new Pos(2,1)]);a.x=this.W/2+(this.W/2-i.width)/2,a.y=t,this.addChild(a)},e}(eui.Group);__reflect(Info.prototype,"Info");var RuleView=function(t){function e(e,n,i){var o=t.call(this)||this;return o.width=150,o.height=150,o.title=e,o.chars=n,o.pos=i,o}return __extends(e,t),e.prototype.childrenCreated=function(){var t=new eui.Label;t.text=this.title,t.size=20,t.textColor=7895160,t.horizontalCenter=0,this.addChild(t);for(var e=new eui.Group,n=[],i=0;i<this.chars.length;i++){n[i]=[];for(var o=0;o<this.chars[i].length;o++){var r=new eui.Button;r.label=this.chars[i][o],""==this.chars[i][o]&&(r.visible=!1),r.touchEnabled=!1,r.width=40,r.height=40,r.x=40*o,r.y=40*i,e.addChild(r),n[i][o]=r}}e.addChild(UiUtils.genLine(this.pos.map(function(t){return n[t.x][t.y]}))),e.horizontalCenter=0,e.y=30,this.addChild(e)},e}(eui.Group);__reflect(RuleView.prototype,"RuleView");var InfoDialog=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=new eui.Group,n=new Info;e.addChild(n);var i=new eui.Button;i.skinName="resource/skins/BtnFacebook.exml",i.horizontalCenter=0,i.top=n.height,i.bottom=30,e.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onFacebook,this),this.content=e},e.prototype.onFacebook=function(){Global.isNative?egret.ExternalInterface.call("jumpUrl","https://www.facebook.com/UU-180961975859505/?ref=bookmarks"):document.location.href="https://www.facebook.com/UU-180961975859505/?ref=bookmarks"},e}(Dialog);__reflect(InfoDialog.prototype,"InfoDialog");var LoadingUI=function(t){function e(e){var n=t.call(this)||this;return n.rootStage=e,RES.getResByUrl("resource/assets/bg.jpg",n.createView,n,RES.ResourceItem.TYPE_IMAGE),n}return __extends(e,t),e.prototype.createView=function(t){var e=t,n=new eui.Image(e);n.width=1e3,n.height=2e3,this.addChild(n),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.textColor=0,this.textField.y=300,this.textField.width=Global.WIDTH,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e,t/e>.5&&window.closeLoadingView&&window.closeLoadingView()},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Logic=function(){function t(){}return t.genData=function(t,e){void 0===t&&(t=10),void 0===e&&(e=8),this.context=0;var n=this.shuffle(this.chars).slice(0,Math.min(e,this.chars.length));return this.index%5==0?this.genData1(n):this.index%5==1?this.genData2Tpl(n,!1):this.index%5==2?this.genData2Tpl(n,!0):this.index%5==3?this.genData3Tpl(n,!0):this.index%5==4?this.genData3Tpl(n,!1):void 0},t.genData1=function(t){for(var e=this.genItemDuplicate(t,64),n=0,i=[],o=0;10>o;o++){i[o]=[];for(var r=0;10>r;r++)0==o||9==o||0==r||9==r?i[o][r]="":i[o][r]=e[n++]}return i},t.genData2Tpl=function(t,e){for(var n=this.genItemDuplicate(t,56),i=0,o=[],r=this.random(2,7),a=0;10>a;a++){o[a]=[];for(var s=0;10>s;s++)0==a||9==a||0==s||9==s||(e?a==r:s==r)?o[a][s]="":o[a][s]=n[i++]}return o},t.genData3Tpl=function(t,e){for(var n=this.genItemDuplicate(t,56),i=0,o=[],r=0;10>r;r++){o[r]=[];for(var a=0;10>a;a++)0==r||9==r||0==a||9==a||(e?r==a:r==9-a)?o[r][a]="":o[r][a]=n[i++]}return o},t.genItemDuplicate=function(e,n){if(n%2!=0)throw new TypeError("Expected an even number, got "+n+" instead.");for(var i=[],o=0;n/2>o;o++)i[2*o]=e[t.random(0,e.length)],i[2*o+1]=i[2*o];return t.shuffle(i)},t.random=function(t,e){return Math.floor(Math.random()*(e-t))+t},t.shuffle=function(t){if(!Array.isArray(t))throw new TypeError("Expected an Array, got "+typeof t+" instead.");for(var e=t.slice(),n=new Array;e.length;){var i=Math.floor(Math.random()*e.length);n=n.concat(e.splice(i,1))}return n},t.shift=function(t){var e=0;return this.index<=4?e=0:this.index<=9?(0==this.context&&(this.context=this.random(1,4)),e=this.context):e=5,this.internalShift(t,e)},t.internalShift=function(t,e,n,i){if(void 0===e&&(e=4),void 0===n&&(n=new Pos(1,1)),void 0===i&&(i=new Pos(8,8)),!Array.isArray(t))throw new TypeError("Expected an Array, got "+typeof t+" instead.");var o=t.length,r=t[0].length,a=[];if(5==e){for(var s=[],l=n.x;l<=i.x;l++)for(var h=n.y;h<=i.y;h++)s.push(t[l][h]);s=this.shuffle(s);for(var c=0,l=0;o>l;l++){a[l]=[];for(var h=0;r>h;h++)l<n.x||h<n.y||l>i.x||h>i.y?a[l][h]=t[l][h]:a[l][h]=s[c++]}return a}for(var u=i.y-n.y+1,d=i.x-n.x+1,l=0;o>l;l++){a[l]=[];for(var h=0;r>h;h++)l<n.x||h<n.y||l>i.x||h>i.y?a[l][h]=t[l][h]:1==e?a[l][h]=t[l][n.y+(h-n.y+1)%u]:2==e?a[l][h]=t[l][n.y+(h-n.y-1+u)%u]:3==e?a[l][h]=t[n.x+(l-n.x+1)%d][h]:4==e?a[l][h]=t[n.x+(l-n.x-1+d)%d][h]:0==e&&(a[l][h]=t[l][h])}return a},t.reverseFlat=function(t,e){for(var n=[[]],i=0,o=0,r=0;r<t.length;r++)n[i][o]=t[r],o++,o==e&&(o=0,i++,r<t.length-1&&(n[i]=[]));return n},t.flat=function(t){return[].concat.apply([],t)},t.chars=["我","是","中","国","人","1","2","3","4","5"],t.index=0,t.context=0,t}();__reflect(Logic.prototype,"Logic");var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.loadingTimeExpired=!1,e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){var e=this;t.prototype.createChildren.call(this),egret.ExternalInterface.addCallback("setSize",function(t){console.log("From Native(setSize):"+t);var e=JSON.parse(t).width,n=JSON.parse(t).height;Global.initWH(e,n,!0)}),Global.stage=this.stage,Global.root=this,egret.Capabilities.isMobile?this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH:this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,Global.init(),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var n=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",n),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI(this.stage),this.stage.addChild(this.loadingView),setTimeout(function(){e.loadingTimeExpired=!0,e.createScene()},500),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.loadingTimeExpired&&this.startCreateScene()},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(Math.floor(100*t.itemsLoaded/t.itemsTotal),100)},e.prototype.startCreateScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,n=this.stage.stageHeight;t.width=e,t.height=n,new GameManager(this).start(),this.stage.removeChild(this.loadingView)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Mission=function(t){function e(e,n){var i=t.call(this)||this;return i.index=e,i.chars=n,Logic.chars=n.split("").filter(function(t){return"\n"!=t&&" "!=t}).filter(function(t,e,n){return n.indexOf(t)===e}),Logic.index=e,i.once(egret.Event.REMOVED_FROM_STAGE,i.clear,i),i}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.addChild(this.createHeader()),this.board=this.createBoard(),this.addChild(this.board)},e.prototype.createBoard=function(){var t=this,e=new Board(function(){return t.showSucDialog()});return e.x=(Global.WIDTH-700)/2,e.y=180,e},e.prototype.createHeader=function(){var t=new eui.Group;t.height=100,t.width=640;var e=new eui.Button;e.skinName="resource/skins/BtnPause.exml",e.left=20,e.verticalCenter=0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPauseWidget,this),t.addChild(e);var n=new eui.Label;n.size=20,n.text=this.chars,n.textColor=0,n.horizontalCenter=0,n.verticalCenter=0,n.textAlign=egret.HorizontalAlign.CENTER,t.addChild(n),this.cellInfo=n,this.startAnimation();var i=new eui.Group;i.width=150,i.height=80,i.right=10,i.top=10,t.addChild(i),i.addChild(UiUtils.getImage("timebg",150,80));var o=new egret.BitmapText;return o.font=RES.getRes("time_fnt"),o.x=5,o.verticalAlign=egret.VerticalAlign.MIDDLE,o.width=150,o.height=80,o.text=TimeUtils.formatTime(0),i.addChild(o),this.clock=new Clock(function(t){return o.text=TimeUtils.formatTime(t)}),this.clock.start(),t},e.prototype.startAnimation=function(){var t=this,e=this.cellInfo,n=function(){var i=egret.Tween.get(e);i.to({alpha:1,scaleX:0},2e3,egret.Ease.sineOut),i.to({alpha:1,scaleX:1},2e3,egret.Ease.sineIn),i.wait(2e3),i.call(n,t)};n()},e.prototype.clear=function(){null!=this.levelInfo&&null!=this.levelInfo.parent&&(this.levelInfo.parent.removeChild(this.levelInfo),this.levelInfo=null)},e.prototype.showPauseWidget=function(t){var e=this;this.clock.pause();var n=new MissionPauseDialog;n.onClose(function(){return e.clock.resume()}),n.onResume(function(){return e.restart()}),n.title="暂停",n.show()},e.prototype.restart=function(){this.clock.reset(),this.clock.resume(),this.removeChild(this.board),this.board.removeChildren(),this.board=this.createBoard(),this.addChild(this.board)},e.prototype.showSucDialog=function(){var t=this;this.clock.pause();var e=new MissionSucDialog(this.clock.time);e.onRestartCallback=function(){return t.restart()},e.show()},e}(eui.Group);__reflect(Mission.prototype,"Mission");var Clock=function(){function t(t){this.t=0,this.callback=t,this.t=0}return t.prototype.start=function(){this.resume()},t.prototype.pause=function(){clearInterval(this.timer)},t.prototype.resume=function(){var t=this;this.timer=setInterval(function(){t.t++,t.callback(t.t)},1e3)},t.prototype.reset=function(){this.t=0},Object.defineProperty(t.prototype,"time",{get:function(){return this.t},enumerable:!0,configurable:!0}),t}();__reflect(Clock.prototype,"Clock");var MissionPauseDialog=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=new eui.Group,n=new Info;e.addChild(n);var i=new eui.Group;i.height=110,i.width=500,i.horizontalCenter=0;var o=new eui.HorizontalLayout;o.gap=10,o.paddingTop=10,o.paddingBottom=20,o.horizontalAlign=egret.HorizontalAlign.CENTER,i.layout=o;var r=new eui.Button;r.skinName="resource/skins/BtnHome.exml",r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onHome,this),i.addChild(r);var a=UiUtils.getBitmap("music1",80,80),s=UiUtils.getBitmap("music1_off",80,80);i.addChild(new Switch(a,s,StoreManager.getInstance().isBgSoundOn(),function(t){SoundManager.getInstance().playBgSound(t),StoreManager.getInstance().setBgSound(t)}));var l=UiUtils.getBitmap("music2",80,80),h=UiUtils.getBitmap("music2_off",80,80);i.addChild(new Switch(l,h,StoreManager.getInstance().isEffectSoundOn(),function(t){SoundManager.getInstance().setSoundEffectSwitch(t),StoreManager.getInstance().setEffectSound(t)}));var c=new eui.Button;c.skinName="resource/skins/BtnRestart.exml",c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRestart,this),i.addChild(c),i.y=n.height,e.addChild(i),this.content=e},e.prototype.onHome=function(){this.close(),UIManager.getInstance().dispatchEvent(new MyEvent(MyEvent.OPEN_SELECT_BOOK))},e.prototype.onRestart=function(){this.close(),this.onRestartCallback&&this.onRestartCallback()},e.prototype.onResume=function(t){this.onRestartCallback=t},e}(Dialog);__reflect(MissionPauseDialog.prototype,"MissionPauseDialog");var STATUS;!function(t){t[t.NORMAL=0]="NORMAL",t[t.EMPTY=1]="EMPTY",t[t.PRESS=2]="PRESS"}(STATUS||(STATUS={}));var Pos=function(){function t(t,e){this.x=t,this.y=e}return t}();__reflect(Pos.prototype,"Pos");var Cell=function(){function t(t,e,n){this.info=n,this.index=t,this.status=e}return t.prototype.same=function(t){return this.info==t.info?!0:void 0},t.prototype.isEmpty=function(){return this.status==STATUS.EMPTY},t}();__reflect(Cell.prototype,"Cell");var CellRenderer=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!0,e.button=new eui.Button,e.percentWidth=100,e.percentHeight=100,e.button.percentWidth=100,e.button.percentHeight=100,e.addChild(e.button),e}return __extends(e,t),e.prototype.dataChanged=function(){var t=this.data;t.status==STATUS.EMPTY?this.button.visible=!1:t.status==STATUS.PRESS?(this.button.label=t.info,this.button.currentState="down",this.button.visible=!0):(this.button.label=t.info,this.button.currentState="up",this.button.visible=!0)},e}(eui.ItemRenderer);__reflect(CellRenderer.prototype,"CellRenderer");var Board=function(t){function e(e){var n=t.call(this)||this;n.WIDTH=700,n.HEIGHT=700,n.SIZE=10,n.CELL=70,n.data=[],n.myCollection=new eui.ArrayCollection,n.sucCallback=e;for(var i=Logic.genData(n.SIZE),o=0;o<n.SIZE;o++){n.data[o]=[];for(var r=0;r<n.SIZE;r++)n.data[o][r]=new Cell(o,""==i[o][r]?STATUS.EMPTY:STATUS.NORMAL,i[o][r]),n.myCollection.addItem(n.data[o][r])}return n}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this);var n=new eui.DataGroup;n.dataProvider=this.myCollection,this.addChild(n),n.itemRenderer=CellRenderer,n.touchChildren=!0;var i=new eui.TileLayout;i.columnWidth=this.CELL,i.rowHeight=this.CELL,i.horizontalGap=0,i.verticalGap=0,n.layout=i,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t,n){var i=t.target.parent.data;if(void 0==e.pre)e.pre=i,e.preObj=t.target,i.status=STATUS.PRESS,e.myCollection.itemUpdated(i);else if(i!=e.pre)if(i.info==e.pre.info){var o=e.myCollection.source,r=e.connectTwo2(Logic.reverseFlat(o,e.SIZE),i,e.pre);if(null==r)return e.pre.status=STATUS.NORMAL,i.status=STATUS.PRESS,e.myCollection.itemUpdated(i),e.myCollection.itemUpdated(e.pre),e.pre=i,void(e.preObj=t.target);i.status=STATUS.EMPTY,e.pre.status=STATUS.EMPTY;var a=e.genLine(r,e.CELL);a.x=t.target.parent.x+e.CELL/2,a.y=t.target.parent.y+e.CELL/2,e.addChild(a),setTimeout(function(){return e.removeChild(a)},100),e.myCollection.itemUpdated(i),e.myCollection.itemUpdated(e.pre),e.particle1.x=t.target.parent.x+e.CELL/2,e.particle1.y=t.target.parent.y+e.CELL/2,e.particle1.start(50),e.particle2.x=e.preObj.parent.x+e.CELL/2,e.particle2.y=e.preObj.parent.y+e.CELL/2,e.particle2.start(50),SoundManager.getInstance().playEffectSound("bomb_wav"),e.pre=void 0,e.preObj=void 0;var s=e.myCollection.source,l=Logic.reverseFlat(s,e.SIZE),h=Logic.shift(l),c=Logic.flat(h);setTimeout(function(){return e.myCollection.replaceAll(c)},250),e.checkSuc(c)}else e.pre.status=STATUS.NORMAL,i.status=STATUS.PRESS,e.myCollection.itemUpdated(i),e.myCollection.itemUpdated(e.pre),e.pre=i,e.preObj=t.target},this),this.addParticle()},e.prototype.checkSuc=function(t){t.every(function(t){return t.isEmpty()})&&this.sucCallback&&this.sucCallback()},e.prototype.addParticle=function(){var t=RES.getRes("star1_png"),e=RES.getRes("star1_json");this.particle1=new particle.GravityParticleSystem(t,e),this.particle2=new particle.GravityParticleSystem(t,e),this.addChild(this.particle1),this.addChild(this.particle2)},e.prototype.genLine=function(t,e){var n=16711680,i=1,o=new egret.Shape;o.graphics.beginFill(n,i);for(var r=0,a=0,s=1;s<t.length;s++){var l=t[s-1].x,h=t[s].x,c=t[s-1].y,u=t[s].y;l==h?(o.graphics.drawRect(u>c?r:r-(c-u)*e,a,Math.abs(u-c)*e,e/10),r+=(u-c)*e):c==u&&(o.graphics.drawRect(r,h>l?a:a-(l-h)*e,e/10,Math.abs(h-l)*e),a+=(h-l)*e)}return o.graphics.endFill(),o.touchEnabled=!1,o},e.prototype.connectZero=function(t,e,n){if(e.x!=n.x&&e.y!=n.y)return!1;if(e.x==n.x){for(var i=Math.min(e.y,n.y),o=Math.max(e.y,n.y),r=i+1;o>r;r++)if(!t[e.x][r].isEmpty())return!1;return!0}if(e.y==n.y){for(var i=Math.min(e.x,n.x),o=Math.max(e.x,n.x),r=i+1;o>r;r++)if(!t[r][e.y].isEmpty())return!1;return!0}},e.prototype.connectOne=function(t,e,n){if(e.x==n.x||e.y==n.y)return null;var i=e.x,o=n.y,r=new Pos(i,o);return t[i][o].isEmpty()&&this.connectZero(t,e,r)&&this.connectZero(t,n,r)?r:(i=n.x,o=e.y,r=new Pos(i,o),t[i][o].isEmpty()&&this.connectZero(t,e,r)&&this.connectZero(t,n,r)?r:null)},e.prototype.connectTwo2=function(t,e,n){for(var i=null,o=null,r=0;r<t.length;r++)for(var a=0;a<t[r].length;a++)e===t[r][a]&&(i=new Pos(r,a)),n===t[r][a]&&(o=new Pos(r,a));return null==i||null==o?null:this.connectTwo1(t,i,o)},e.prototype.connectTwo1=function(t,e,n){if(this.connectZero(t,e,n))return[e,n];var i=this.connectOne(t,e,n);if(null!=i)return[e,i,n];for(var o=[],r=e.x+1;r<t.length&&t[r][e.y].isEmpty();r++)if(r!=n.x){var a=this.connectOne(t,new Pos(r,e.y),n);null!=a&&o.push([{x:r,y:e.y},a])}for(var r=e.x-1;r>=0&&t[r][e.y].isEmpty();r--)if(r!=n.x){var a=this.connectOne(t,new Pos(r,e.y),n);null!=a&&o.push([{x:r,y:e.y},a])}for(var r=e.y-1;r>=0&&t[e.x][r].isEmpty();r--)if(r!=n.y){var a=this.connectOne(t,new Pos(e.x,r),n);null!=a&&o.push([{x:e.x,y:r},a])}for(var r=e.y+1;r<t[0].length&&t[e.x][r].isEmpty();r++)if(r!=n.y){var a=this.connectOne(t,new Pos(e.x,r),n);null!=a&&o.push([{x:e.x,y:r},a])}if(0==o.length)return null;for(var s=null,l=1e8,r=0;r<o.length;r++){var a=o[r],h=this.distance([e,a[0],a[1],n]);l>h&&(l=h,s=a)}return[e,s[0],s[1],n]},e.prototype.distance=function(t){for(var e=0,n=1;n<t.length;n++)e+=Math.abs(t[n].x-t[n-1].x)+Math.abs(t[n].y-t[n-1].y);return e},e}(eui.Group);__reflect(Board.prototype,"Board");var RowRenderer=function(t){function e(){var e=t.call(this)||this;return e.row=new eui.DataGroup,e.row.percentWidth=100,e.row.height=100,e.addChild(e.row),e.row.itemRenderer=CellRenderer,e.row.layout=new eui.HorizontalLayout,e.touchChildren=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.row.dataProvider=new eui.ArrayCollection(this.data)},e}(eui.ItemRenderer);__reflect(RowRenderer.prototype,"RowRenderer");var CellRenderer1=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!1,e.button=new eui.Button,e.addChild(e.button),e}return __extends(e,t),e.prototype.dataChanged=function(){"3item"!=this.data.label?this.button.label=this.data.label:this.button.visible=!1,1==this.data.p&&(this.button.label=this.data.label+"ppp")},e}(eui.ItemRenderer);__reflect(CellRenderer1.prototype,"CellRenderer1");var LabelRenderer=function(t){function e(){var e=t.call(this)||this;return e.touchChildren=!0,e.labelDisplay=new eui.Label,e.width=30,e.addChild(e.labelDisplay),e}return __extends(e,t),e.prototype.dataChanged=function(){this.labelDisplay.text=this.data.label},e}(eui.ItemRenderer);__reflect(LabelRenderer.prototype,"LabelRenderer");
var SelectBook2=function(t){function e(){var n=t.call(this,void 0)||this;n.shapes=[],n.scales=[],n.xSize=300,n.ySize=300,n.offsetX=300,n.cur=0,n.WIDTH=Global.WIDTH;for(var i=0;5>i;i++){var o=new e.Item(i,i+"","book_bg");n.shapes.push(o)}return n.count=n.shapes.length,n.scale=1/n.count,n.once(egret.Event.REMOVED_FROM_STAGE,n.clear,n),n}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this);for(var e=0;e<this.shapes.length;e++){var n=this.shapes[e];n.anchorOffsetX=this.xSize/2,n.anchorOffsetY=this.ySize/2,n.width=this.xSize,n.height=this.ySize,n.x=this.WIDTH/2+this.offsetX*e,n.y=400,this.scales[e]=1-this.scale*e,n.scaleX=this.scales[e],n.scaleY=this.scales[e],this.addChild(n)}this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this);var i=new SelectBookMenu;i.x=(Global.WIDTH-i.width)/2,i.y=800,this.addChild(i);var o=new SelectBookTitle("汉字连连看");o.x=(Global.WIDTH-o.width)/2,o.y=50,this.addChild(o)},e.prototype.startMove=function(t){this.startX=t.stageX},e.prototype.onMove=function(t){var e=t.stageX-this.startX;if(this.startX=t.stageX,!(this.shapes[0].x+e>this.WIDTH/2||this.shapes[this.count-1].x+e<this.WIDTH/2))for(var n=0;n<this.shapes.length;n++){var i=this.shapes[n];i.x+=e,this.scales[n]-=this.scale*e/this.offsetX,i.scaleX=this.scales[n]>1?2-this.scales[n]:this.scales[n],i.scaleY=this.scales[n]>1?2-this.scales[n]:this.scales[n]}},e.prototype.clear=function(){},e}(Page);__reflect(SelectBook2.prototype,"SelectBook2"),function(t){var e=function(t){function e(e,n,i){var o=t.call(this)||this;o.index=e,o.book=GameData.getInstance().books[o.index];var r=RES.getRes(i),a=new eui.Image(r);a.width=300,a.height=400,o.addChild(a);var s=new egret.BitmapText;s.font=RES.getRes("title2_fnt"),s.text=o.book.name,s.y=50,s.x=(300-s.width)/2,o.addChild(s);var l=UiUtils.getBitmap("star1_png",100,100);l.x=(300-l.width)/2,l.y=200,o.addChild(l);var h=45*o.book.chapters.length,c=new eui.Label(o.book.totalStar+"/"+h);return UIManager.getInstance().addEventListener(MyEvent.DATA_UPDATE,function(t,e){t.lable=o.book.totalStar+"/"+h},c),c.textColor=0,c.width=300,c.height=60,c.textAlign=egret.HorizontalAlign.CENTER,c.y=300,c.size=30,o.addChild(c),o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,o.onClick,o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onClick,o),o}return __extends(e,t),e.prototype.onClick=function(t){if(t.type==egret.TouchEvent.TOUCH_BEGIN)this.startTime=(new Date).getTime();else if(t.type==egret.TouchEvent.TOUCH_TAP){var e=(new Date).getTime()-this.startTime;if(200>e){var n=new MyEvent(MyEvent.OPEN_SELECT_CHAPTER);console.log(this.index),GlobalIndex.book=this.index,n.data=GameData.getInstance().books[this.index],UIManager.getInstance().dispatchEvent(n)}}},e}(eui.Group);t.Item=e,__reflect(e.prototype,"SelectBook2.Item")}(SelectBook2||(SelectBook2={}));var Switch=function(t){function e(e,n,i,o){void 0===i&&(i=!0),void 0===o&&(o=null);var r=t.call(this)||this;return r.callback=o,r.addChild(e),r.addChild(n),r.width=Math.max(e.width,n.width),r.height=Math.max(e.height,n.height),r.selectedIndex=i?0:1,r.addEventListener(egret.TouchEvent.TOUCH_TAP,r.onTap,r),r}return __extends(e,t),e.prototype.onTap=function(t){this.selectedIndex=0==this.selectedIndex?1:0,this.callback&&this.callback(0==this.selectedIndex)},e.prototype.childrenCreated=function(){this.callback&&this.callback(0==this.selectedIndex)},e}(eui.ViewStack);__reflect(Switch.prototype,"Switch");var SelectBookMenu=function(t){function e(){var e=t.call(this)||this;e.height=100,e.width=400;var n=new eui.HorizontalLayout;n.gap=10,n.paddingTop=10,n.paddingBottom=10,n.horizontalAlign=egret.HorizontalAlign.CENTER,e.layout=n;var i=UiUtils.getBitmap("music1",80,80),o=UiUtils.getBitmap("music1_off",80,80);e.addChild(new Switch(i,o,StoreManager.getInstance().isBgSoundOn(),function(t){SoundManager.getInstance().playBgSound(t),StoreManager.getInstance().setBgSound(t)}));var r=UiUtils.getBitmap("music2",80,80),a=UiUtils.getBitmap("music2_off",80,80);e.addChild(new Switch(r,a,StoreManager.getInstance().isEffectSoundOn(),function(t){SoundManager.getInstance().setSoundEffectSwitch(t),StoreManager.getInstance().setEffectSound(t)}));var s=UiUtils.getImage("info",80,80);return s.addEventListener(egret.TouchEvent.TOUCH_TAP,e.openInfo,e),e.addChild(s),e}return __extends(e,t),e.prototype.openInfo=function(){var t=(new eui.Panel,new InfoDialog);t.title="游戏介绍",t.show()},e}(eui.Group);__reflect(SelectBookMenu.prototype,"SelectBookMenu");var SelectBookTitle=function(t){function e(e){for(var n=t.call(this)||this,i=e.split(""),o=RES.getRes("title_fnt"),r=i.map(function(t){var e=new egret.BitmapText;return e.text=t,e.font=o,n.addChild(e),e}),a=0,s=0;s<r.length;s++)r[s].x=a,a+=r[s].width;for(var l=[0,1e3,2e3,1e3,0],h=function(t){setTimeout(function(){var e=egret.Tween.get(r[t],{loop:!0});e.to({y:50},2e3,egret.Ease.sineOut),e.to({y:0},2e3,egret.Ease.sineIn)},l[t%5])},s=0;s<r.length;s++)h(s);return n.width=a,n.height=r[0].height+100,n}return __extends(e,t),e}(eui.Group);__reflect(SelectBookTitle.prototype,"SelectBookTitle");var SelectChapter=function(t){function e(e){var n=t.call(this,e)||this;return n.book=e,n}return __extends(e,t),e.prototype.createChildren=function(){var n=this;t.prototype.createChildren.call(this);var i=new eui.Group;i.height=100,i.width=640;var o=UiUtils.getImage("back",60,60);o.left=20,o.verticalCenter=0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return UIManager.getInstance().dispatchEvent(new MyEvent(MyEvent.OPEN_SELECT_BOOK))},this),i.addChild(o);var r=new eui.Label;r.size=60,r.text=this.book.name,r.textColor=0,r.horizontalCenter=0,r.verticalCenter=0,r.textAlign=egret.HorizontalAlign.CENTER,i.addChild(r);var a=45*this.book.chapters.length,s=new eui.Label(this.book.totalStar+"/"+a);UIManager.getInstance().addEventListener(MyEvent.DATA_UPDATE,function(t,e){t.lable=n.book.totalStar+"/"+a},s),s.textColor=0,s.right=10,s.size=30,s.verticalCenter=0,i.addChild(s);var l=UiUtils.getImage("star1_png",60,60);l.right=s.width+10,l.verticalCenter=0,i.addChild(l),this.addChild(i),this.once(egret.Event.REMOVED_FROM_STAGE,this.clear,this);for(var h=new eui.Group,c=this.book,u=100*c.chapters.length,d=0;d<c.chapters.length;d++){var p=new e.Item(c.chapters[d],d);p.x=u-100-100*d,p.width=100,p.height=600,p.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,p),h.addChild(p)}var g=new eui.Scroller;g.viewport=h,g.viewport.scrollH=u-Global.WIDTH,g.y=150,g.height=605,g.width=Global.WIDTH,this.addChild(g)},e.prototype.clear=function(){},e.prototype.onClick=function(t){if(!this.data.lock){var e=new MyEvent(MyEvent.OPEN_SELECT_MISSION);e.data=this.data,GlobalIndex.chapter=this.index,UIManager.getInstance().dispatchEvent(e)}},e}(Page);__reflect(SelectChapter.prototype,"SelectChapter"),function(t){var e=function(t){function e(e,n){var i=t.call(this)||this;return i.w0=100,i.h0=600,i.width=i.w0,i.height=i.h0,i.data=e,i.index=n,i.starNum=e.totalStar,i.once(egret.Event.REMOVED_FROM_STAGE,i.clear,i),i}return __extends(e,t),e.prototype.createChildren=function(){this.addChild(UiUtils.getShape(this.w0,this.h0,16382441,this.index%2==0?.9:1));var t=new eui.Label;t.verticalAlign=egret.VerticalAlign.MIDDLE,t.textAlign=egret.HorizontalAlign.CENTER,t.size=30,t.width=100,t.height=80,t.text=(this.index+1).toString(),t.textColor=0,this.addChild(t);var e=new eui.Label;if(e.textAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.textColor=0,e.size=28,e.y=80,e.width=100,e.height=420,e.text=this.trans(this.data.chars),this.addChild(e),this.data.lock){var n=RES.getRes("mainsuo"),i=new eui.Image(n);i.x=(100-n.textureWidth)/2,i.y=500+(100-n.textureHeight)/2,this.addChild(i)}else{var o=RES.getRes("listli_starl"),r=new eui.Image(o);r.x=(100-o.textureWidth)/2,r.y=500+(50-o.textureHeight)/2,this.addChild(r);var a=new eui.Label;this.addChild(a),a.text=this.starNum+"/45",a.width=100,a.height=50,a.y=550,a.x=0,a.textColor=0,a.textAlign=egret.HorizontalAlign.CENTER}},e.prototype.trans=function(t){var e=t.split("\n"),n=Math.max.apply(null,e.map(function(t){return t.length})),i=[];e.forEach(function(t,e){if(i[e]=t.split(""),i[e].length<n){i[e].splice(0,0,"　");for(var o=i[e].length;n>o;o++)i[e][o]=" "}});for(var o=[],r=0;r<i.length;r++)for(var a=0;n>a;a++)void 0==o[a]&&(o[a]=[]),o[a][i.length-1-r]=i[r][a];var s=o.map(function(t){return t.join("").replaceAll(" ","　")}).join("\n");return s},e.prototype.clear=function(){},e}(eui.Group);t.Item=e,__reflect(e.prototype,"SelectChapter.Item")}(SelectChapter||(SelectChapter={}));var SelectMission=function(t){function e(e){var n=t.call(this,e)||this;return n.data=e,n.addChild(UiUtils.getShape(Global.WIDTH,Global.HEIGHT,0,.85)),n.once(egret.Event.ADDED_TO_STAGE,n.onStage,n),n}return __extends(e,t),e.prototype.onStage=function(t){for(var n=0;15>n;n++){var i=new e.Item(n,this.data);i.name=n.toString(),i.x=80+160*(n%3),i.y=80+150*Math.floor(n/3),this.addChild(i)}},e}(Page);__reflect(SelectMission.prototype,"SelectMission"),function(t){var e=function(t){function e(e,n){var i=t.call(this)||this;i.index=e,i.data=n,i.width=160,i.height=150;var o=RES.getRes("listli_bg0"),r=new eui.Image(o);r.width=100,r.height=100,r.x=30,i.addChild(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onClick,i);var a=n.star[e];if(0>a){var s=i.getLock();i.addChild(s)}else{var l=i.getNumber(e);i.addChild(l),l.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onClick,i),i.addChild(i.getStar(a))}return i}return __extends(e,t),e.prototype.onClick=function(t){if(!(this.data.star[this.index]<0)){var e=new MyEvent(MyEvent.OPEN_MISSION);e.data={index:this.index,chars:this.data.chars},GlobalIndex.mission=this.index,UIManager.getInstance().dispatchEvent(e)}},e.prototype.getLock=function(){var t=RES.getRes("mainsuo"),e=new eui.Image(t);return e.x=(160-t.textureWidth)/2,e.y=(100-t.textureHeight)/2,e},e.prototype.getNumber=function(t){var e=new eui.Label;return e.text=t.toString(),e.x=(160-e.width)/2,e.y=(100-e.height)/2,e},e.prototype.getStar=function(t){var e=new eui.Group;e.width=100,e.height=30,e.x=30,e.y=100;for(var n=0;3>n;n++){var i=RES.getRes(t>n?"listli_starl":"listli_stara"),o=new eui.Image(i);o.x=33*n+1.5,e.addChild(o)}return e},e.prototype.clear=function(){},e}(eui.Group);t.Item=e,__reflect(e.prototype,"SelectMission.Item")}(SelectMission||(SelectMission={}));var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function o(t){e.call(i,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(i))}var a=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(i,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),o(t),egret.callLater(function(){e.call(i,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var TimeUtils=function(){function t(){}return t.formatNumber=function(t,e){return 3==e?t>999?"999":Math.floor(t/100)+""+Math.floor(t%100/10)+t%10:2==e?t>99?"99":Math.floor(t/10)+""+t%10:void 0},t.formatTime=function(t){var e=Math.floor(t/60),n=t%60;return this.formatNumber(e,2)+":"+this.formatNumber(n,2)},t}();__reflect(TimeUtils.prototype,"TimeUtils");var UiUtils=function(){function t(){}return t.getShape=function(t,e,n,i){void 0===t&&(t=640),void 0===e&&(e=960),void 0===n&&(n=0),void 0===i&&(i=.7);var o=new egret.Shape;return o.graphics.beginFill(n,i),o.graphics.drawRect(0,0,t,e),o.graphics.endFill(),o.touchEnabled=!1,o},t.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},t.getBitmap=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=new egret.Bitmap,o=RES.getRes(t);return i.texture=o,e>0&&(i.width=e),n>0&&(i.height=n),i},t.getImage=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=new eui.Image;return i.source=t,e>0&&(i.width=e),n>0&&(i.height=n),i},t.getCenter=function(t){var e=t.x+t.width/2,n=t.y+t.height/2;return new Pos(e,n)},t.genLine=function(e,n,i){void 0===n&&(n=4),void 0===i&&(i=16711680);var o=new egret.Shape;o.graphics.lineStyle(n,i);var r=t.getCenter(e[0]);o.graphics.moveTo(r.x,r.y);for(var a=1;a<e.length;a++){var s=t.getCenter(e[a]);o.graphics.lineTo(s.x,s.y)}return o.graphics.endFill(),o.touchEnabled=!1,o},t}();__reflect(UiUtils.prototype,"UiUtils");var MyEvent=function(t){function e(e,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var o=t.call(this,e,n,i)||this;return o.data=null,o}return __extends(e,t),e.UI_SHOW="UI_SHOW",e.UI_CLOSE="UI_CLOSE",e.OPEN_SELECT_BOOK="OPEN_SELECT_BOOK",e.OPEN_SELECT_CHAPTER="OPEN_SELECT_CHAPTER",e.OPEN_SELECT_MISSION="OPEN_SELECT_MISSION",e.OPEN_MISSION="OPEN_MISSION",e.DATA_UPDATE="DATA_UPDATE",e}(egret.Event);__reflect(MyEvent.prototype,"MyEvent");var MyEventDispatcher=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}(egret.EventDispatcher);__reflect(MyEventDispatcher.prototype,"MyEventDispatcher");var SoundManager=function(){function t(){this.bg_position=0,this.sound_switch=!1,this.sound_effect_switch=!1}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.playBgSound=function(e){t.autoPlay||!e?this.realPlayBgSound(e):(t.autoPlay=!0,this.realPlayBgSound(e))},t.prototype.realPlayBgSound=function(t){this.sound_switch=t,t?(null==this.bgSound&&(this.bgSound=RES.getRes("bg_mp3")),null!=this.bgChannel&&(this.bgChannel.stop(),this.bgChannel=null),this.bgChannel=this.bgSound.play(this.bg_position,0)):null!=this.bgChannel?(this.bg_position=this.bgChannel.position,this.bgChannel.stop(),this.bgChannel=null):this.bg_position=0},t.prototype.setSoundEffectSwitch=function(t){this.sound_effect_switch=t},t.prototype.playEffectSound=function(t){if(this.sound_effect_switch){var e=RES.getRes(t);if(null!=e){var n=e.play(0,1),i={s:e,c:n},o=function(){this.c.stop(),this.c=null,this.s=null};n.addEventListener(egret.Event.SOUND_COMPLETE,o,i)}}},t.autoPlay=!1,t}();__reflect(SoundManager.prototype,"SoundManager");var StoreManager=function(){function t(){}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.isBgSoundOn=function(){return"0"!=egret.localStorage.getItem("musicBg")},t.prototype.setBgSound=function(t){egret.localStorage.setItem("musicBg",t?"1":"0")},t.prototype.isEffectSoundOn=function(){return"0"!=egret.localStorage.getItem("musicEffect")},t.prototype.setEffectSound=function(t){egret.localStorage.setItem("musicEffect",t?"1":"0")},t.prototype.getGameData=function(){return egret.localStorage.getItem("gameData")},t.prototype.storeGameData=function(t){egret.localStorage.setItem("gameData",t)},t}();__reflect(StoreManager.prototype,"StoreManager");var UIManager=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.openPage=function(){},e.prototype.dispatchEvent=function(e){return t.prototype.dispatchEvent.call(this,e)},e.prototype.show=function(t){var e=new MyEvent(MyEvent.UI_SHOW);e.data=t,this.dispatchEvent(e)},e.prototype.close=function(t){var e=new MyEvent(MyEvent.UI_CLOSE);e.data=t,this.dispatchEvent(e)},e}(egret.EventDispatcher);__reflect(UIManager.prototype,"UIManager"),String.prototype.replaceAll=function(t,e){var n=new RegExp(t,"g");return this.replace(n,e)};